<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>zutSEO DANE</title>
	<link href="bootstrap-combined.min.css" rel="stylesheet">

	<style>
		body {background:#eee;}
		.btn {margin:3px;}
		.btn-primary.active {background-color: #036;}
	</style>	
	
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>	
	<script type="text/javascript" charset="utf-8" src="cordova-2.2.0.js"></script> 	
	<script type="text/javascript" charset="utf-8" src="seo.js"></script>
    
<script type="text/javascript">
	
	
var script=document.createElement('SCRIPT');
script.type='text/javascript';
script.src='http://zszczech.zut.edu.pl/SEO/zapisy/json.php?callback=fooseo&ile=0';
document.getElementsByTagName('head')[0].appendChild(script);	


//var skala=1000;
var ffaktor = window.localStorage.getItem('___faktor') || 'search';
var dane=[];

	
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
	  
	  
       function drawChart() {
        var data = google.visualization.arrayToDataTable(dane);
        var options = {
          title: nazwa(ffaktor),
		  //vAxis:{maxValue:20,minValue:0}
        };

        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }

   function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
		try {if (device.uuid) {}	}
		catch(err) {onDeviceReady();}
    }


    function onDeviceReady() {
		document.addEventListener("menubutton", onMenuKeyDown, false);	
		menu();
    }
	function onMenuKeyDown() {
		document.getElementById("menu").style.display="block";
		menu();
    }	
	
	  
	var uczelnie=[];
	var daty=[];
	var faktory=[];
	
	function fooseo(res){
		for (var v in res){
			uczelnie.push(v);
		}
		for (var d in res[uczelnie[0]]){
				daty.push(d);
		}
		opisz(res,daty,uczelnie);
	}



	function opisz(res,daty,uczelnie){
		var arr=[];
		for (var r in res){
			var obj=res[r];
			arr[r]=[];
			for (var d in obj){
				var dat=obj[d];
				arr[r][d]=dat;
			}			
		}
		// szukaj jakie faktory dla menu
		for (var f in arr[r][d]){faktory.push(f);}
		
		dane.push(uczelnie);

		for (var d in daty){
			var data=daty[d];
			var darr=[];
			darr.push(data);
			for (var u in uczelnie){
				var uczelnia=uczelnie[u];
				darr.push(arr[uczelnia][data][ffaktor]);
			}
			dane.push(darr);
		}
		dane[0].unshift('Time');
	}	
  
	function menu(){
		for (var m in faktory){
			if (faktory[m]=='ile') continue;
			if (faktory[m]=='faktor') continue;
			var title=nazwa(faktory[m]);
			var klasa=' btn-info';
			if (title.indexOf('zut') >0) var klasa=' btn-primary';
			if (ffaktor==faktory[m]) klasa+=' active';
			var menu = document.getElementById('menu');
			var bat  = document.createElement("BUTTON");
			bat.className = 'btn'+klasa;
			bat.setAttribute('onClick','ustaw("'+faktory[m]+'")');
			bat.innerHTML=title;
			menu.appendChild(bat);
		}
	}
	  
  
function ustaw(co){
	window.localStorage.setItem('___faktor',co);
	window.location.reload();
}	  
	  
    </script>
  </head>

<body onload="onLoad()">

	<div id="menu">  
		<button class="btn btn-inverse" onClick="window.open('index.html','_parent')">Dane</button> 
		<button class="btn"             onClick="window.open('wykres-uczelnie.html','_parent')">Wykres Uczelnie</button> 
		<button class="btn"             onClick="window.open('wykres-dane.html','_parent')">Wykres Dane</button> 	
		<button class="btn btn-warning" onClick="koniec()">Koniec</button>   
	</div>
	
    <div id="chart_div" style="width: 600px; height: 400px;"></div>
	
</body>
</html>